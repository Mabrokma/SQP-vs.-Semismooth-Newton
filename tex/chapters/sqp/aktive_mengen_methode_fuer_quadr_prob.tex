
Wir haben gesehen, dass das SQP-Verfahren
quadratische Optimierungsprobleme mit linearen Restriktionen
als Teilprobleme hat.
Wir werden jetzt aufklären, wie wir diese Probleme
mit dem Aktive-Mengen-Verfahren lösen können.

\begin{definition}
\emph{(Quadratische Optimierungsprobleme mit linearen Restriktionen)}
\begin{align}
  \min_{x \in \R^n}\ & f(x) :=
    \frac{1}{2} \langle Qx,x \rangle + \langle q,x \rangle 
    \tag{QLU} \label{prob:quad_opt_prob_mit_lin_ungl_nebenbed} \\
                 \nb & Ax = b \notag \\
                     & Gx \leq r \notag
\end{align}
Dabei sei $Q$ eine symmetrische $(n \times n)$-Matrix und $q \in \R^n$.
$A$ sei eine $(m \times n)$-Matrix mit $m \leq n$ und $b \in \R^m$.
$G$ sei eine $(p \times n)$-Matrix und $r \in \R^p$.
\end{definition}

Die Idee des Aktive-Mengen-Verfahrens ist, iterativ Probleme
mit nur Gleichungsnebenbedingungen zu optimieren.
% TODO weiter erklären

Sei $x^k \in \R^n$ ein zulässiger Punkt des Problems~\eqref{prob:quad_opt_prob_mit_lin_ungl_nebenbed}.
Angenommen, wir können eine Suchrichtung $d \in \R^n$ finden,
sodass der Punkt $x^{k+1} := x^k + d$ ein besserer zulässiger Punkt ist.
Diesen Vektor $d$ können wir finden, indem wir das Problem
\begin{align}
  \min_{d \in \R^n}\ &
    \frac{1}{2} \langle Q(x^k+d), x^k+d \rangle + \langle q, x^k+d \rangle 
      \\
                 \nb & A(x^k+d) = b \notag \\
                     & G(x^k+d) \leq r \notag
\end{align}
lösen.
Dies ist eigentlich das Problem~\eqref{prob:quad_opt_prob_mit_lin_ungl_nebenbed},
wobei die Variable $x$ mit $x^k + d$ ersetzt wurde und das Problem über
die Variable $d$ minimiert werden soll.

Lassen wir die Konstanten in der Zielfunktion weg, dann bekommen wir
als Zielfunktion
\begin{displaymath}
  \frac{1}{2} \langle Qd,d \rangle + \langle Qx^k+q,d\rangle.
\end{displaymath}
Weil $x^k$ zulässig ist, d.\,h., es gilt $Ax^k = b$,
können wir dann als Gleichungsnebenbedingungen
$Ad = 0$ schreiben.

Seien $g_j \in \R^n$, $j = 1,\ldots,p$,
die Transponierten der Zeilenvektoren in $G$, d.\,h.
$G = \left(\begin{array}{c}
g_1^T \\ \vdots \\ g_p^T
\end{array}\right)$,
und $J(x^k) := \{ 1 \leq j \leq p \ | \ \langle g_j,x^k \rangle = r_j \}$ die
Indexmenge der aktiven Ungleichungsrestriktionen zu $x^k$.

Ist eine Ungleichungsrestriktion zu $x^k$ mit Index $j$ aktiv,
dann kann diese Ungleichungsrestriktion auch zu $x^k+d$ aktiv bleiben,
wenn $\langle g_j, d \rangle = 0$ gilt.

Seien $J_k := J(x^k)$, $p_k := |J_k|$,
$j_1, \ldots, j_{p_k} \in J_k$ und
$G_k = \left(\begin{array}{c}
g_{j_1}^T \\ \vdots \\ g_{j_{p_k}}^T
\end{array}\right)$.

Wir definieren dann folgendes Teilproblem nur mit
linearen Gleichungsnebenbedingungen:
\begin{align}
  \min_{d \in \R^n}\ & \frac{1}{2} \langle Qd,d \rangle
                       + \langle Qx^k+q,d\rangle
    \tag{$Q_k$} \label{prob:teilprob_in_aktive_mengen_verfahren} \\
  \nb & Ad = 0 \notag \\
      & G_k d = 0. \notag
\end{align}

Sei $d$ eine Lösung des
Problems~\eqref{prob:teilprob_in_aktive_mengen_verfahren}.
Dann existiert nach Satz~\ref{satz:notw_bed_fuer_prob_mit_lin_gl_nebenbed}
ein Lagrange-Multiplikator
$\tilde{\lambda} = \left(\begin{array}{c} \lambda \\ \mu \end{array}\right)$
mit $\lambda \in \R^m$ und $\mu \in \R^{p_k}$, sodass
\begin{equation}
\label{eq:notw_bed_teilprob_in_aktive_mengen_verfahren}
Qd + Qx^k + q + A^T \lambda + G_k^T \mu = 0.
\end{equation}

Sei $d \neq 0$. Wir können dann zeigen, dass $d$ eine Abstiegsrichtung ist,
vorrausgesetzt, dass die Matrix $Q$ positiv definit ist.
Für den Gradient der Zielfunktion des
Problems~\eqref{prob:quad_opt_prob_mit_lin_ungl_nebenbed}
an der Stelle $x^k$ gilt
wegen~\eqref{eq:notw_bed_teilprob_in_aktive_mengen_verfahren}
\begin{equation}
\nabla f(x^k) = Qx^k + q = -Qd - A^T \lambda - G_k^T \mu
\end{equation}
und somit
\begin{equation}
\nabla f(x^k)^T d = -d^T Q d - \lambda^T A d - \mu^T G_k d
  = -d^T Q d
\end{equation}
wegen $Ad=0$ und $G_k d=0$.
D.\,h. $\nabla f(x^k)^T d < 0$ für positiv definite Matrix Q.

Da wir nur $j \in J_k$ betrachten,
kann es sein,
dass die Ungleichung $\langle g_i, x^k+d \rangle \leq r_i$
für $i \in I_k := \{ 1, \ldots, p \} \backslash J_k$ verletzt wurde.
Definiere Schrittweite durch
\begin{equation}
  \tau_k :=
  \begin{cases}
    \min\left\{ \frac{r_j - g_j^T x^k}{g_j^T d^k}\ | \ j \in I_k \right\},
      & \text{falls } I_k \neq \emptyset \\
    \infty,
      & \text{sonst}.
  \end{cases}
\end{equation}
und
\begin{equation}
  \sigma_k := \min \{ 1, \tau_k\}.
\end{equation}

Diese Schrittweite brauchen wir, damit $x^{k+1}$ ein zulässiger Punkt bleibt.

\begin{algorithm}
\emph{(Aktive-Mengen-Verfahren
für \eqref{prob:quad_opt_prob_mit_lin_ungl_nebenbed},
vgl. Verfahren 6.2.1 in \cite[S.~213]{alt})}
\begin{compactenum}[1.]
  \item Wähle einen Startpunkt $x^0$. Setze $k:=0$.
  \item Löse das Problem~\eqref{prob:teilprob_in_aktive_mengen_verfahren}
        $\Rightarrow d^k, \lambda^k, \mu^k$.
  \item Falls $d^k = 0$
    \begin{compactenum}[3a.]
      \item Falls $\mu^k \geq 0 \Rightarrow$ STOP.
      \item Falls $\mu^k \ngeq 0$
        \begin{compactenum}[i.]
          \item Bestimme $j \in J(x^k)$, sodass
                $\mu_j^k = \min\{ \mu_i^k \ |\ i \in J(x^k) \}$.
          \item $J(x^k) := J(x^k)\backslash\{j\}$ 
          \item Streiche in $G_k$ die $j$-te Zeile.
          \item Löse wieder das Problem~\eqref{prob:teilprob_in_aktive_mengen_verfahren}
                $\Rightarrow d^k \neq 0$
        \end{compactenum}
    \end{compactenum}
  \item Berechne Schrittweite $\sigma_k$.
  \item Setze $x^{k+1} := x^k + \sigma_k d^k$ und $k := k+1$.
        $\Rightarrow $ Gehe zu Schritt 2. %FIMXE use label
\end{compactenum}
\end{algorithm}
